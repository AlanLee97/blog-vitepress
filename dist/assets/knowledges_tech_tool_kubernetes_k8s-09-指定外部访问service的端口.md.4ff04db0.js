import{_ as s,o as n,c as a,b as e}from"./app.d2d47940.js";const A=JSON.parse('{"title":"Kubernetes 指定外部访问service的端口","description":"","frontmatter":{},"headers":[{"level":2,"title":"集群外部方式访问：NodePort","slug":"集群外部方式访问-nodeport","link":"#集群外部方式访问-nodeport","children":[]}],"relativePath":"knowledges/tech/tool/kubernetes/k8s-09-指定外部访问service的端口.md","lastUpdated":1678618356000}'),p={name:"knowledges/tech/tool/kubernetes/k8s-09-指定外部访问service的端口.md"},l=e(`<h1 id="kubernetes-指定外部访问service的端口" tabindex="-1">Kubernetes 指定外部访问service的端口 <a class="header-anchor" href="#kubernetes-指定外部访问service的端口" aria-hidden="true">#</a></h1><h2 id="集群外部方式访问-nodeport" tabindex="-1">集群外部方式访问：NodePort <a class="header-anchor" href="#集群外部方式访问-nodeport" aria-hidden="true">#</a></h2><p>NodePort在kubenretes里是一个早期广泛应用的服务暴露方式。Kubernetes中的service默认情况下都是使用的ClusterIP这种类型，这样的service会产生一个ClusterIP，这个IP只能在集群内部访问，要想让外部能够直接访问service，需要将service type修改为 nodePort。将service监听端口映射到node节点。</p><p><strong>配置</strong></p><p>在Service的spec节点中</p><p>指定类型：type NodePort</p><p>指定端口：nodePort: 30001</p><p>指定协议：protocol: TCP</p><p><img src="https://alanlee-image-bed.oss-cn-shenzhen.aliyuncs.com/note_images/20200303105547-576040.png#alt=%EF%BC%9A" alt=""></p><p>完整Service的配置如下：</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Service</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">panda-config-http</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8888</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">targetPort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8888</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">nodePort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30001</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">protocol</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">TCP</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NodePort</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">panda-config</span></span>
<span class="line"></span></code></pre></div><p><strong>运行</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">k8s-panda-config.yml</span></span>
<span class="line"></span></code></pre></div><p>查看service</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">service</span></span>
<span class="line"></span></code></pre></div><p><img src="https://alanlee-image-bed.oss-cn-shenzhen.aliyuncs.com/note_images/20200303110206-20539.png#alt=image-20200303110206020" alt=""></p><p><strong>结果</strong></p><p>浏览器访问</p><p><img src="https://alanlee-image-bed.oss-cn-shenzhen.aliyuncs.com/note_images/20200303110250-294715.png#alt=image-20200303110250136" alt=""></p>`,19),o=[l];function t(c,r,i,y,C,d){return n(),a("div",null,o)}const F=s(p,[["render",t]]);export{A as __pageData,F as default};
