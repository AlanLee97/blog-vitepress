import{_ as s,o as n,c as a,b as e}from"./app.d2d47940.js";const F=JSON.parse('{"title":"Kubernetes 修改默认的端口范围","description":"","frontmatter":{"date":"2020-02-29T00:00:00.000Z","categories":["运维"],"tags":["kubernetes"]},"headers":[],"relativePath":"knowledges/tech/tool/kubernetes/k8s-04-修改默认的端口范围.md","lastUpdated":1678618356000}'),p={name:"knowledges/tech/tool/kubernetes/k8s-04-修改默认的端口范围.md"},l=e(`<h1 id="kubernetes-修改默认的端口范围" tabindex="-1">Kubernetes 修改默认的端口范围 <a class="header-anchor" href="#kubernetes-修改默认的端口范围" aria-hidden="true">#</a></h1><p>Kubernetes 服务的 NodePort 默认端口范围是 30000-32767，在某些场合下，这个限制不太适用，我们可以自定义它的端口范围，操作步骤如下：</p><p>编辑 <code>vi /etc/kubernetes/manifests/kube-apiserver.yaml</code> 配置文件，增加配置 <code>--service-node-port-range=2-65535</code></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Pod</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">creationTimestamp</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">component</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kube-apiserver</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">tier</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">control-plane</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kube-apiserver</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kube-system</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">command</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kube-apiserver</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;"># 在这里增加配置即可</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--service-node-port-range=2-65535</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--advertise-address=192.168.141.150</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--allow-privileged=true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--authorization-mode=Node,RBAC</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--client-ca-file=/etc/kubernetes/pki/ca.crt</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--enable-admission-plugins=NodeRestriction</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--enable-bootstrap-token-auth=true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#C3E88D;">// 以下配置省略...</span></span>
<span class="line"></span></code></pre></div><p>使用 <code>docker ps</code> 命令找到 <code>kube-apiserver</code> 容器，再使用 <code>docker restart</code> 即可生效。</p>`,5),o=[l];function t(c,r,D,y,C,i){return n(),a("div",null,o)}const d=s(p,[["render",t]]);export{F as __pageData,d as default};
