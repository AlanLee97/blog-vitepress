import{_ as s,o as a,c as n,b as l}from"./app.d2d47940.js";const D=JSON.parse('{"title":"LVS","description":"","frontmatter":{},"headers":[{"level":2,"title":"配置DR服务器","slug":"配置dr服务器","link":"#配置dr服务器","children":[]},{"level":2,"title":"配置RS服务器","slug":"配置rs服务器","link":"#配置rs服务器","children":[]}],"relativePath":"knowledges/tech/server/linux-centos/LVS.md","lastUpdated":1678618356000}'),p={name:"knowledges/tech/server/linux-centos/LVS.md"},o=l(`<h1 id="lvs" tabindex="-1">LVS <a class="header-anchor" href="#lvs" aria-hidden="true">#</a></h1><p>Linux Virtual Server</p><table><thead><tr><th>名称</th><th>IP</th><th>软件</th></tr></thead><tbody><tr><td>DR(Master)</td><td>192.168.1.20</td><td></td></tr><tr><td>vip:192.168.1.100</td><td>keepalived,ipvsadm</td><td></td></tr><tr><td>DR(BACKUP)</td><td>192.168.1.20</td><td></td></tr><tr><td>vip:192.168.1.100</td><td>keepalived,ipvsadm</td><td></td></tr><tr><td>RS1</td><td>192.168.1.22</td><td></td></tr><tr><td>隐藏vip:192.168.1.100</td><td>nginx</td><td></td></tr><tr><td>RS2</td><td>192.168.1.23</td><td></td></tr><tr><td>隐藏vip:192.168.1.100</td><td>nginx</td><td></td></tr></tbody></table><h2 id="配置dr服务器" tabindex="-1">配置DR服务器 <a class="header-anchor" href="#配置dr服务器" aria-hidden="true">#</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">ifconfig ens33:192.168.1.100/24</span></span>
<span class="line"><span style="color:#A6ACCD;">route add -host 192.168.1.100 dev ens33</span></span>
<span class="line"><span style="color:#A6ACCD;">ipvsadm -A -t 192.168.1.100:80 -s wlc</span></span>
<span class="line"><span style="color:#A6ACCD;">ipvsadm -a -t 192.168.1.100:80 -s wlc -r 192.168.1.22 -g -w 1</span></span>
<span class="line"><span style="color:#A6ACCD;">ipvsadm -a -t 192.168.1.100:80 -s wlc -r 192.168.1.23 -g -w 1</span></span>
<span class="line"><span style="color:#A6ACCD;">ipvsadm -Ln</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">route add -host 192.168.1.100 dev ens33</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="配置rs服务器" tabindex="-1">配置RS服务器 <a class="header-anchor" href="#配置rs服务器" aria-hidden="true">#</a></h2><p>在2台RS服务器上操作</p><p>修改内核参数</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/proc/sys/net/ipv4/conf/ens33/arp_ignore</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/proc/sys/net/ipv4/conf/all/arp_ignore</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/proc/sys/net/ipv4/conf/ens33/arp_announce</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/proc/sys/net/ipv4/conf/all/arp_announce</span></span>
<span class="line"></span></code></pre></div><p>在两台机器（RS）上，设置网卡的别名IP：192.168.1.200</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">ifconfig</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lo:</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.100</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">netmask</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">255.255.255.255</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">broadcast</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.100</span></span>
<span class="line"></span></code></pre></div><p>在两台机器（RS）上，添加一个路由</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">route</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-host</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.200</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lo:</span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span></code></pre></div><p>DR上需要加一个路由设置</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">route</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-host</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.100</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ens33</span></span>
<span class="line"></span></code></pre></div><p>在DR上使用ipvsadm添加集群服务</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">Ipvsadm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">–C</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ipvsadm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-A</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.100:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">wlc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ipvsadm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.100:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.21</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-w</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ipvsadm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.100:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.1.22</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-w</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span></code></pre></div>`,18),e=[o];function t(c,r,C,d,i,y){return a(),n("div",null,e)}const h=s(p,[["render",t]]);export{D as __pageData,h as default};
